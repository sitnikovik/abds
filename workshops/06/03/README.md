# Аналитика качества показаний

## Бизнес-проблема

Нужно понять, какие **квартиры** давно не отправляют показания, где застой данных, какое распределение значений.

## Требования

Построить витрину [«звезда»](https://ru.wikipedia.org/wiki/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0_%D0%B7%D0%B2%D0%B5%D0%B7%D0%B4%D1%8B) в ClickHouse, а затем — графики в Superset, позволяющие понять динамику потребления.

> В качестве измерений можно использовать таблицы-справочники `flats`, `residents` и таблицу `gauges` с показаниями, поступающими в реальном времени.

Таблица фактов, должна содержать как минимум

- Связь с квартирой
- Дата последнего показания
- Дельта T1/T2 показаний
- Признак "заброшенности"

Дашборд в Superset должен содержать:

- ❗️ Bar chart — квартиры с самыми старыми данными
- ❗️ Big number — средний лаг (пропуски передачи показаний)
- ❗️ Pie chart — нормальные / проблемные квартиры
- Histogram — распределение T1/T2

## Сначала сделать

### Поднимаем проект

```sh
# Поднимет окружение в Docker с необходимыми ресурсами
make run
```

### Запускаем "Энергосбыт"

⚠️ Пересоздайте топик Kafka с показаниями если остался с прошлого занатия

```sh
make .purge-kafka-gauges
```

Настроим ClickHouse, заполним нужны таблицы и запустим передачу показаний в реальном времени

```sh
make energosbyt
```

### Остановить проект

```sh
# Остановит все Docker-контейнеры и запущенные команды
make stop
```
