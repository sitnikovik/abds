# Группа 1. Энергосбыт: учёт потребления электроэнергии

## Контекст задачи

Компания «ЭнергоДом» обслуживает многоквартирные дома.  
В каждой квартире фиксируется потребление электроэнергии через умные счётчики.  
Менеджеры и аналитики хотят видеть не только текущее потребление, но и историю изменений тарифов, корректировок показаний и потребления по месяцам.  

### Важные сущности

- **Квартира** — уникальный номер квартиры, этаж, дом  
- **Счётчик** — уникальный id, привязка к квартире, дата установки  
- **Показания** — дата, показание, тип (реальное, корректировка, перерасчёт)  
- **Тарифы** — стоимость кВт⋅ч по периодам, возможные изменения  
- **События** — замена счётчика, корректировка показаний, изменение тарифа, жалобы, перерасчёты  

## Возможные бизнес-сценарии

1. **Ежемесячное снятие показаний**  
   - Счётчик фиксирует потребление каждый месяц  
   - Нужно хранить историю всех показаний  

2. **Замена счётчика**  
   - Старый счётчик сломался или устарел  
   - История старого счётчика сохраняется, новый счётчик привязывается к квартире с даты установки  

3. **Корректировка показаний**  
   - Ошибка в предыдущем снятии показаний или жалоба жильца  
   - История должна фиксировать оригинальное и исправленное значение, а также причину  

4. **Изменение тарифа**  
   - Тариф может меняться с определённой даты  
   - Важно понимать, какой тариф применялся к показаниям за любой месяц  

5. **Перерасчёт потребления**  
   - После корректировки или изменения тарифа  
   - Нужно фиксировать, какие значения были пересчитаны и какой итог  

## Что требуется

1. **Спроектировать модель хранения**, которая позволяет:
   - видеть текущее потребление квартиры  
   - хранить историю показаний, корректировок, замены счётчиков и тарифов  
   - восстанавливать состояние на любую дату  
   - фиксировать причины корректировок и замен  

2. **Продумать обработку событий и backfill**:
   - как фиксировать новые события и исправления  
   - как сохранить целостность данных  
   - как быстро получать актуальные значения и историю изменений  

3. **Создать тестовый набор данных**:  
   - 5–10 событий на 2–3 квартиры  
   - Покрыть сценарии: обычное снятие показаний, корректировка, замена счётчика, изменение тарифа  

4. **Подготовить запросы/выборки**:  
   - текущее потребление квартиры  
   - история показаний  
   - пересчитанное потребление после корректировки или изменения тарифа  
   - аналитика: среднее потребление по дому за месяц, выявление квартир с необычно высоким потреблением  

5. **Обосновать выбранный подход**:
   - какие подходы хранения истории использованы  
   - плюсы и минусы модели  
   - как выбранная схема упрощает или усложняет работу с данными  

## Чек-лист сдачи

1. DDL всех таблиц с пояснением  
2. DML: 5–10 событий, демонстрирующих ключевые сценарии  
3. SELECT-запросы: current state, history, as-of date, аналитика  
4. Обоснование выбранного подхода и стратегии обработки корректировок