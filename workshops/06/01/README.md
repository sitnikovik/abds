# Аналитика трендов потребления во времени

## Бизнес-проблема

Энергосбыт хочет видеть, как меняется потребление электричества во времени — по дням, неделям и месяцам.
Это базовая продуктовая аналитика: сезонность, пики, тренды, падения.

## Требования

Построить витрину [«звезда»](https://ru.wikipedia.org/wiki/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0_%D0%B7%D0%B2%D0%B5%D0%B7%D0%B4%D1%8B) в ClickHouse, а затем — графики в Superset, позволяющие понять динамику потребления.

Таблица фактов, должна содержать как минимум

- Дата передачи показания
- Связь с квартирой
- Дельты T1/T2

> В качестве измерений можно использовать таблицы-справочники `flats`, `residents` и таблицу `gauges` с показаниями, поступающими в реальном времени.

Дашборд в Superset должен содержать:

- ❗️ Line Chart — общий тренд потребления (сумма) по району
- ❗️ Line Chart — сравнение T1 vs T2 по дням за прошедший месяц
- Bar Chart — ТОП-20 квартир по потреблению за последнюю неделю
- Big Number — общее потребление вчера / за месяц (два числа)

## Сначала сделать

### Поднимаем проект

```sh
# Поднимет окружение в Docker с необходимыми ресурсами
make run
```

### Запускаем "Энергосбыт"

⚠️ Пересоздайте топик Kafka с показаниями если остался с прошлого занатия

```sh
make .purge-kafka-gauges
```

Настроим ClickHouse, заполним нужны таблицы и запустим передачу показаний в реальном времени

```sh
make energosbyt
```

### Superset

Откройте [панель Superset](https://localhost:8088) и создайте подключение к ClickHouse используя

```plaintext
clickhousedb://default@ch1:8123/default
```

### Остановить проект

```sh
# Остановит все Docker-контейнеры и запущенные команды
make stop
```
