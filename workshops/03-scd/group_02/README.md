# Группа 2. Доставка: курьеры и заказы

## Контекст задачи

Компания «ШПЭК» работает с сетью курьеров, которые развозят заказы покупателям.

У каждого заказа есть:

- сам заказ (id, дата, стоимость)
- курьер, которому он назначен
- время доставки
- статус заказа (новый, в пути, доставлен, отменён)
- город и район доставки

Менеджеры компании хотят отслеживать:

1. Как менялись статусы заказов во времени
2. Как часто курьеры менялись по одному и тому же заказу (например, если один заболел и заказ передали другому)
3. Сколько времени в среднем занимает доставка в разных районах и как это меняется

По условиям бизнеса:

- Курьер может поменяться несколько раз, пока заказ не будет доставлен
- Статус заказа может изменяться
  - ***новый*** → ***в пути*** → ***доставлен*** | ***возврат*** | ***не доставлен***
  - либо ***новый*** → ***отменён***

## Возможные бизнес-сценарии

1. **Заказ не приняли**  
   - Клиент оформил заказ, но никто из курьеров его не взял в течение 30 минут
   - Заказ отменяется автоматически

2. **Курьер опаздывает**  
   - Курьер принял заказ, но не успел доставить в обещанное время
   - Менеджерам важно фиксировать такие случаи, чтобы потом считать SL

3. **Замена курьера**  
   - Курьер заболел или уехал не в тот район
   - Заказ перепоручили другому курьеру
   - Важно сохранить историю: кто и сколько времени отвечал за заказ

4. **Отмена заказа клиентом**
    - Клиент передумал (например, уехал из дома)
    - Заказ должен быть переведён в статус «отменён»
    - Нужно понимать: отмена была со стороны клиента или по вине курьера

5. **Успешная доставка**
   - Курьер довёз заказ вовремя
   - Нужно фиксировать время завершения, чтобы рассчитать среднюю скорость доставки по районам

## Что требуется

1. Построить схему базы данных так, чтобы:
    - можно было видеть текущий статус заказа
    - можно было проследить всю историю изменения статусов
    - можно было восстановить, какие курьеры когда обслуживали заказ
    - можно было учитывать разные причины отмены или задержки

2. Сохранить возможность в будущем быстро отвечать на вопросы:
    - Сколько заказов отменялось в каждом районе за последний месяц?
    - Сколько заказов пришлось передавать от одного курьера к другому?
    - Как менялось среднее время доставки по районам (например, сравнить этот месяц и прошлый)?
    - Как часто курьеры опаздывали по сравнению с обещанным временем?

3. Подготовить SQL-структуру таблиц и продумать механизм фиксации изменений

4. Обосновать свой выбор:
    - Какую стратегию хранения истории вы выбрали?
    - Почему именно так?
    - Какие плюсы и минусы у вашего решения?

## Чек-лист сдачи задания

1. DDL всех таблиц и объяснение, зачем каждая нужна
2. Несколько INSERT-ов, демонстрирующих кейсы: назначение, опоздание+переназначение, отмена, доставка
3. SELECT-запросы: current view, история статусов, хронология курьеров по заказу, подсчёт передач, среднее время доставки по районам
4. Короткое обоснование выбора хранения истории (какие SCD использованы, почему)