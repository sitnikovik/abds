# Аналитика энергоэффективности и площадей

## Бизнес-проблема

Управляющая компания хочет понять, как площадь квартиры и количество жильцов влияют на потребление.
Цель — оценить энергоэффективность: кто тратит много “на квадратный метр”, кто — экономно.

## Требования

Построить витрину [«звезда»](https://ru.wikipedia.org/wiki/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0_%D0%B7%D0%B2%D0%B5%D0%B7%D0%B4%D1%8B) в ClickHouse, а затем — графики в Superset, позволяющие понять динамику потребления.

> В качестве измерений можно использовать таблицы-справочники `flats`, `residents` и таблицу `gauges` с показаниями, поступающими в реальном времени.

Таблица фактов, должна содержать как минимум

- Связь с квартирой
- Общая дельта T1/T2 за последние 30 дней
- Площадь квартиры
- Кол-во жильцов
- Нормированное потребление (x = дельта / площадь)
- Норма на одного жильца (x = делта / кол-во жильцов)

Дашборд в Superset должен содержать:

- ❗️ Bar Chart — квартиры с худшей энергоэффективностью (по норме потребления)
- ❗️ Big Number + Line Chart — среднее нормированное потребление в районе
- Histogram — распределение энергоэффективности
- Pie Chart — категории энергопотребления:
  - низкое
  - среднее
  - высокое


## Сначала сделать

### Поднимаем проект

```sh
# Поднимет окружение в Docker с необходимыми ресурсами
make run
```

### Запускаем "Энергосбыт"

⚠️ Пересоздайте топик Kafka с показаниями если остался с прошлого занатия

```sh
make .purge-kafka-gauges
```

Настроим ClickHouse, заполним нужны таблицы и запустим передачу показаний в реальном времени

```sh
make energosbyt
```

### Остановить проект

```sh
# Остановит все Docker-контейнеры и запущенные команды
make stop
```
