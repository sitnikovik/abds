# Аналитика активности жильцов

## Бизнес-проблема

Нужно оценить дисциплину жильцов: кто передаёт данные, как часто, кто — нет.

> В качестве учебной практики, введём, что жильцы **передают** показания **раз в день** (а не раз в месяц)

## Требования

Построить витрину [«звезда»](https://ru.wikipedia.org/wiki/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0_%D0%B7%D0%B2%D0%B5%D0%B7%D0%B4%D1%8B) в ClickHouse, а затем — графики в Superset, позволяющие понять динамику потребления.

> В качестве измерений можно использовать таблицы-справочники `flats`, `residents` и таблицу `gauges` с показаниями, поступающими в реальном времени.

Таблица фактов, должна содержать как минимум

- Связь с жильцом
- Связь с квартирой
- Сколько раз передавал показания **за последние 30 дней** (т.е. не пропускает передачу показаний)

Дашборд в Superset должен содержать:

- ❗️ Bar chart — топ-активных жильцов (фио, квартира)
- ❗️ Histogram — интервалы между показаниями
- ❗️ Pie chart — активные / неактивные жильцы
- ❗️ Line chart — количество показаний по дням


## Сначала сделать

### Поднимаем проект

```sh
# Поднимет окружение в Docker с необходимыми ресурсами
make run
```

### Запускаем "Энергосбыт"

⚠️ Пересоздайте топик Kafka с показаниями если остался с прошлого занатия

```sh
make .purge-kafka-gauges
```

Настроим ClickHouse, заполним нужны таблицы и запустим передачу показаний в реальном времени

```sh
make energosbyt
```

### Остановить проект

```sh
# Остановит все Docker-контейнеры и запущенные команды
make stop
```
