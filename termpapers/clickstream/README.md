# Clickstream-аналитика

## Введение

Clickstream-аналитика — это система сбора, обработки и анализа событий поведения пользователей на сайте или в приложении.

В рамках курсовой работы требуется реализовать прототип платформы clickstream-аналитики
только для **просмотра** элементов страницы и **кликов** по ним.

## Цель работы

Создать работающий прототип clickstream-системы, способный:

- собирать события пользовательских кликов из разных источников
- обрабатывать и агрегировать данные из событий
- формировать витрины
- визуализировать метрики в аналитических дашбордах

## Постановка задачи

Студент должен реализовать следующие блоки:

### Сбор данных

Необходимо реализовать получение данных из трёх разных источников:

- файл .csv
- HTTP
- Брокер сообщений
- Трекер в браузере (**по желанию**)
  - можно написать простой HTML + JS, отправляющий события и не требующий авторизации
  - может быть удобен при отладке и демонстрации работы

Каждый источник должен поставлять события одного формата.

#### Генерация данных

В вашем проекте должны быть **файлы** с тестовыми/фейковыми данными для импорта в хранилище.

Помимо этого, БД должна пополняться данными из брокера сообщений (Kafka/RabbitMQ)
через запущенную в фоне программу для генерации событий кликов, добавляюмых в брокер в **реальном времени**.

### Хранение данных

#### Примерная схема

> Схемы могут быть доработаны на ваше усмотрение

##### Событие

- `id` *UInt64* — уникальный идентификатор события
- `type` *String* — тип события (view, click)
- `created_at` *DateTime* — время генерации события
- `received_at` *DateTime* — время приёма системой
- `session_id` *String* — идентификатор сессии пользователя
- `ip` *String*/*IP* - IPv4 адрес устройства
- `user_id` *UInt64* — уникальный пользователь
- `url` *String* — полный URL страницы
- `referrer` *String* — URL источник перехода
- `device_type` *String* — тип устройства (desktop/mobile/tablet)
- `user_agent` *String* — User-Agent устройства/браузера
- `payload` *JSON* — сырой JSON события с **кастомным** набором полей
  - `event_title` *String* - кастомное название события, например, "checkout" (форма оплаты заказа),
  для разделения бизнес-кейсов при анализе
  - `element_id` *String* - CSS-идентификтор элемента, например, `#submut-button`
  - `x` *UInt32* - координаты курсора клика по оси *X*
  - `y` *UInt32* - координаты курсора клика по оси *Y*

##### Пользователь

- `id` *UInt64* — уникальный идентификатор пользователя
- `fio` *String* — ФИО пользователя
- `country` *String* - ISO-код страны

### REST API для взаимодействия с приложением

> Должен быть, **как минимум**, **1 эндпоинт**.
> Можно добавлять и другие на свое усмотрение, например, для удобства отладки или демонстрации работы.

`POST /events`

Принимает событие.

Пример запроса

```json
[
    {
        "type": "click",
        "session_id": "user-session-1001",
        "user_id": 1001,
        "url": "/catalog?foo=bar",
        "created_at": "2025-01-01T10:00:00Z",
        "user_agent": "Mozilla/5.0 (Linux; Android 7.1.1; SM-J700T1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3882.0",
        "payload": {
            "event_title": "checkout",
            "element_id": "#submit-button"
            "x": 445,
            "y": 315,
        }
    }
]
```

### Мониторинг

Используйте [Prometheus](https://prometheus.io/), [Grafana](https://grafana.com/)
для настройки мониторинга работы сервиса и инфраструктуры.

> Метрики мониторинга могут быть кастомизированы на ваше усмотрение

Рекомендуется настроить

- RPS приложения, response time, latency
- Использование ресурсов (CPU, оперативная и постоянная память, сеть)
- Статус компонентов системы (БД, брокеры и т.д.)

### ETL-пайплайн

> Может быть доработан на ваше усмотрение

Ожидается минимум 1 DAG, например:

- Загрузка сырых данных из источников в хранилище
- Очистка и валидация события (удаление дубликатов, проверка обязательных полей)
- Парсинг пэйлоада события и создание структурированных данных
- Построение витрин для аналитики

### Аналитический дашборд

#### Инструменты

- Apache Superset (предпочтительнее)
- Metabase
- Grafana (при большом желании)

#### Требования

- Активность пользователей (DAU/WAU/MAU)
- Heatmap/Line chart кликов элементов к их просмотрам
- Процент конверсии клика к просмотру
- Средняя длительность сессии пользователя (сколько времени проводит на сайте)
- Распределение устройств по их типу
- Топ-10 страниц

## Минимальные требования

- Сгенерировать не менее 200 000 событий
- 3 источника данных
  - файлы
  - HTTP
  - брокер сообщений
- Хранилище
- БД для очищенных данных и витрин
- ETL-пайплайн
- Витрины
- Аналитический дашборд
