version: '3.7'
x-environment: &environment
  CLICKHOUSE_USER: default
  CLICKHOUSE_PASSWORD: ""
  CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT: 1
  CLICKHOUSE_CONFIG_max_memory_usage: 30000000000
  CLICKHOUSE_CONFIG_max_partitions_per_insert_block: 100
  CLICKHOUSE_CONFIG_max_concurrent_queries: 20
  CLICKHOUSE_CONFIG_max_threads: 4
  CLICKHOUSE_REPLICATION: "1"
services:
  ch1:
    image: clickhouse/clickhouse-server:25.8
    container_name: ch1
    ports:
      - "8123:8123" # Веб-интерфейс
      - "9000:9000"
    volumes:
      - ./ch1_volume:/var/lib/clickhouse
      - ./config/clickhouse/config.d:/etc/clickhouse-server/config.d:ro
    environment:
      <<: *environment
  ch2:
    image: clickhouse/clickhouse-server:25.8
    container_name: ch2
    ports:
      - "8124:8123" # Веб-интерфейс
      - "9001:9000"
    volumes:
      - ./ch2_volume:/var/lib/clickhouse
      - ./config/clickhouse/config.d:/etc/clickhouse-server/config.d:ro
    environment:
      <<: *environment
volumes:
  ch1_volume:
    driver: local
  ch2_volume:
    driver: local